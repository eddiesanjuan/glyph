name: Keep API Warm

on:
  schedule:
    # Every 5 minutes
    - cron: '*/5 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping API health endpoint
        run: |
          echo "Pinging Glyph API to prevent cold starts..."
          response=$(curl -s -w "\n%{http_code}" https://glyph-api-production-b8ea.up.railway.app/health)
          http_code=$(echo "$response" | tail -1)
          body=$(echo "$response" | head -1)

          echo "Response: $body"
          echo "Status: $http_code"

          if [ "$http_code" != "200" ]; then
            echo "Warning: API returned non-200 status"
            exit 1
          fi

          echo "API is warm and healthy!"

      - name: Ping Docs (optional warmup)
        run: |
          curl -s -o /dev/null -w "Docs: %{http_code} in %{time_total}s\n" https://docs.glyph.you/
        continue-on-error: true

      - name: Ping Dashboard (optional warmup)
        run: |
          curl -s -o /dev/null -w "Dashboard: %{http_code} in %{time_total}s\n" https://dashboard.glyph.you/
        continue-on-error: true
